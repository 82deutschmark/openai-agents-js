---
title: Realtime Agent を Twilio に接続
description: Connect your Agents SDK agents to Twilio to use voice agents
---

import { Aside, Steps, Code } from '@astrojs/starlight/components';
import twilioBasicExample from '../../../../../../examples/docs/extensions/twilio-basic.ts?raw';
import twilioServerExample from '../../../../../../examples/realtime-twilio/index.ts?raw';

Twilio は [Media Streams API](https://www.twilio.com/docs/voice/media-streams) を提供しており、電話の通話からの元音声を WebSocket サーバーへ送信します。これは、あなたの [音声エージェントの概要](/openai-agents-js/ja/guides/voice-agents) を Twilio に接続するために利用できます。Twilio から届くイベントを Realtime Session に接続するには、`websocket` モードのデフォルトの Realtime Session トランスポートを使えます。ただし、Web ベースの会話よりも電話では自然とレイテンシが増えるため、適切な音声フォーマットの設定や、割り込みタイミングの調整が必要になります。

セットアップ体験を向上させるために、割り込み処理や音声転送を含め、Twilio への接続を代わりに処理する専用のトランスポートレイヤーを作成しました。

<Aside type="caution">
  このアダプターはまだベータ版です。エッジケースの問題やバグに遭遇する可能性があります。
  問題は [GitHub issues](https://github.com/openai/openai-agents-js/issues)
  から報告してください。迅速に修正します。
</Aside>

## セットアップ

<Steps>

1. ** Twilio のアカウントと Twilio の電話番号を用意します **

2. ** Twilio からのイベントを受け取れる WebSocket サーバーを用意します **

   ローカルで開発している場合、これはローカルトンネルの設定が必要になり、
   これはローカルトンネルの設定が必要になり、[`ngrok`](https://ngrok.io/) や
   [Cloudflare Tunnel](https://developers.cloudflare.com/pages/how-to/preview-with-cloudflare-tunnel/)
   などを使ってローカルサーバーを Twilio からアクセス可能にします。Twilio への接続には
   `TwilioRealtimeTransportLayer` を使えます。

3. ** 拡張パッケージをインストールして Twilio アダプターを導入します **

   ```bash
   npm install @openai/agents-extensions
   ```

4. ** `RealtimeSession` に接続するためのアダプターとモデルをインポートします **

   <Code
     lang="typescript"
     code={twilioBasicExample.replace(
       /\n\s+\/\/ @ts-expect-error - this is not defined/g,
       '',
     )}
   />

5. ** `RealtimeSession` を Twilio に接続します **

   ```typescript
   session.connect({ apiKey: 'your-openai-api-key' });
   ```

</Steps>

`RealtimeSession` に期待されるあらゆるイベントや動作は、ツール呼び出し、ガードレールなどを含め、想定どおりに機能します。`RealtimeSession` を音声エージェントで使う方法の詳細は、[音声エージェントの概要](/openai-agents-js/ja/guides/voice-agents) を参照してください。

## ヒントと考慮事項

1. ** スピードが命です **

   Twilio から必要なすべてのイベントや音声を受け取るため、WebSocket 接続を参照できるようになったらすぐに
   `TwilioRealtimeTransportLayer` インスタンスを作成し、その直後に `session.connect()` を呼び出してください。

2. ** Twilio の元イベントにアクセスする **

   Twilio が送信する元イベントにアクセスしたい場合は、`RealtimeSession` インスタンスで `transport_event`
   をリッスンします。Twilio からのすべてのイベントは `twilio_message` という type と、元イベントデータを含む
   `message` プロパティを持ちます。

3. ** デバッグログを確認する **

   状況をより詳しく知りたい問題に遭遇することがあります。環境変数 `DEBUG=openai-agents*` を使うと、
   Agents SDK からのすべてのデバッグログが表示されます。あるいは、Twilio アダプターだけのデバッグログを有効にするには
   `DEBUG=openai-agents:extensions:twilio*` を使用できます。

## 完全なサーバー例

以下は、Twilio からのリクエストを受け取り、`RealtimeSession` にフォワードする、WebSocket サーバーの完全な end-to-end の例です。

<Code
  lang="typescript"
  code={twilioServerExample}
  title="Fastify を使ったサーバー例"
/>

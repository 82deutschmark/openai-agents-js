---
title: エージェントの実行
description: Configure and execute agent workflows with the Runner class
---

import { Aside, Code } from '@astrojs/starlight/components';
import helloWorldWithRunnerExample from '../../../../../../examples/docs/hello-world-with-runner.ts?raw';
import helloWorldExample from '../../../../../../examples/docs/hello-world.ts?raw';
import runningAgentsExceptionExample from '../../../../../../examples/docs/running-agents/exceptions1.ts?raw';
import chatLoopExample from '../../../../../../examples/docs/running-agents/chatLoop.ts?raw';

エージェントはそれ自体では何もしません — `Runner` クラスまたは `run()` ユーティリティで **実行** します。

<Code lang="typescript" code={helloWorldExample} title="シンプルな実行" />

カスタム runner が不要な場合は、`run()` ユーティリティも使えます。これはデフォルトのシングルトン `Runner` インスタンスで実行します。

または、自分で runner インスタンスを作成することもできます:

<Code
  lang="typescript"
  code={helloWorldWithRunnerExample}
  title="シンプルな実行"
/>

エージェントを実行すると、最終出力と実行の全履歴を含む [エージェントの実行結果](/openai-agents-js/ja/guides/results) オブジェクトを受け取ります。

## エージェントのループ

Runner の run メソッドを使うときは、開始するエージェントと入力を渡します。入力は文字列（ユーザーのメッセージとして扱われます）か、[input items](/openai-agents-js/openai/agents-core/type-aliases/agentinputitem) のリスト（OpenAI Responses API のアイテム）です。

runner は次のループを実行します:

1. 現在の入力で現在のエージェントのモデルを呼び出します
2. LLM の応答を確認します
   - **Final output** → 返す
   - **Handoff** → 新しいエージェントに切り替え、蓄積された会話履歴は保持し、1 に戻る
   - **Tool calls** → ツールを実行し、その結果を会話に追加して、1 に戻る
3. `maxTurns` に到達したら [`MaxTurnsExceededError`](/openai-agents-js/openai/agents-core/classes/maxturnsexceedederror) をスローします

<Aside type="note">
  LLM
  の出力が「最終出力」と見なされる条件は、目的の型でテキスト出力を生成し、ツール呼び出しが存在しないことです。
</Aside>

### Runner のライフサイクル

アプリの起動時に `Runner` を作成し、リクエスト間で再利用します。このインスタンスはモデルプロバイダやトレーシングのオプションといったグローバル設定を保持します。完全に別のセットアップが必要な場合にのみ別の `Runner` を作成してください。簡単なスクリプトでは、内部でデフォルトの runner を使う `run()` を呼ぶこともできます。

## 実行引数

`run()` メソッドには、実行を開始する初期エージェント、実行用の入力、一連のオプションを渡します。

入力は、文字列（ユーザーのメッセージとして扱われます）、[input items](/openai-agents-js/openai/agents-core/type-aliases/agentinputitem) のリスト、または [人間の介入（HITL）](/openai-agents-js/ja/guides/human-in-the-loop) エージェントを構築している場合は `RunState` オブジェクトのいずれかです。

追加のオプションは次のとおりです:

| オプション | デフォルト | 説明                                                                                                                                                 |
| ---------- | ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| `stream`   | `false`    | `true` の場合、呼び出しは `StreamedRunResult` を返し、モデルから到着したイベントを逐次発行します                                                     |
| `context`  | –          | すべてのツール / ガードレール / ハンドオフに転送される Context オブジェクト。詳しくは [コンテキスト管理](/openai-agents-js/ja/guides/context) を参照 |
| `maxTurns` | `10`       | セーフティリミット — 到達時に [`MaxTurnsExceededError`](/openai-agents-js/openai/agents-core/classes/maxturnsexceedederror) をスロー                 |
| `signal`   | –          | キャンセル用の `AbortSignal`                                                                                                                         |

## ストリーミング

ストリーミングを使うと、LLM の実行中にストリーミングイベントも受け取れます。ストリームが開始されると、`StreamedRunResult` に新しい出力を含む実行の完全な情報が含まれます。`for await` ループでストリーミングイベントを反復処理できます。詳しくは [ストリーミング](/openai-agents-js/ja/guides/streaming) を参照してください。

## 実行設定

独自の `Runner` インスタンスを作成する場合、`RunConfig` オブジェクトを渡して runner を設定できます。

| フィールド                  | 型                    | 目的                                                                                 |
| --------------------------- | --------------------- | ------------------------------------------------------------------------------------ |
| `model`                     | `string \| Model`     | 実行中の **すべて** のエージェントに対して特定のモデルを強制します                   |
| `modelProvider`             | `ModelProvider`       | モデル名を解決します — 既定は OpenAI プロバイダです                                  |
| `modelSettings`             | `ModelSettings`       | 各エージェントの設定を上書きするグローバルな調整パラメーター                         |
| `handoffInputFilter`        | `HandoffInputFilter`  | ハンドオフ を実行する際に入力アイテムを変更します（ハンドオフ 自体で定義がない場合） |
| `inputGuardrails`           | `InputGuardrail[]`    | _最初_ の ユーザー入力に適用される ガードレール                                      |
| `outputGuardrails`          | `OutputGuardrail[]`   | _最終_ 出力に適用される ガードレール                                                 |
| `tracingDisabled`           | `boolean`             | OpenAI Tracing を完全に無効化します                                                  |
| `traceIncludeSensitiveData` | `boolean`             | スパンは発行しつつ、トレースから LLM/ツール の入力と出力を除外します                 |
| `workflowName`              | `string`              | Traces ダッシュボードに表示 — 関連する実行のグループ化に役立ちます                   |
| `traceId` / `groupId`       | `string`              | SDK による自動生成ではなく、トレースまたはグループ ID を手動で指定します             |
| `traceMetadata`             | `Record<string, any>` | 各スパンに付与する任意のメタデータ                                                   |

## 会話 / チャットスレッド

`runner.run()`（または `run()` ユーティリティ）への各呼び出しは、アプリケーションレベルの会話における 1 回の **ターン** を表します。エンドユーザーに `RunResult` のどこまでを見せるかは任意です — `finalOutput` のみを見せる場合もあれば、生成されたアイテムをすべて見せる場合もあります。

<Code lang="typescript" code={chatLoopExample} title="会話履歴を引き継ぐ例" />

インタラクティブ版は [チャットのサンプルコード](https://github.com/openai/openai-agents-js/tree/main/examples/basic/chat.ts) を参照してください。

## 例外

この SDK は、捕捉可能な少数のエラーをスローします:

- [`MaxTurnsExceededError`](/openai-agents-js/openai/agents-core/classes/maxturnsexceedederror) – `maxTurns` に到達
- [`ModelBehaviorError`](/openai-agents-js/openai/agents-core/classes/modelbehaviorerror) – モデルが無効な出力を生成（例: 不正な形式の JSON、未知のツール）
- [`InputGuardrailTripwireTriggered`](/openai-agents-js/openai/agents-core/classes/inputguardrailtripwiretriggered) / [`OutputGuardrailTripwireTriggered`](/openai-agents-js/openai/agents-core/classes/outputguardrailtripwiretriggered) – ガードレール違反
- [`GuardrailExecutionError`](/openai-agents-js/openai/agents-core/classes/guardrailexecutionerror) – ガードレールが完了できなかった
- [`ToolCallError`](/openai-agents-js/openai/agents-core/classes/toolcallerror) – 関数ツールの呼び出しのいずれかが失敗
- [`UserError`](/openai-agents-js/openai/agents-core/classes/usererror) – 設定やユーザー入力に基づき発生したエラー

いずれも基底の `AgentsError` クラスを継承しており、現在の実行状態にアクセスするための `state` プロパティを提供する場合があります。

`GuardrailExecutionError` を処理するサンプルコードは次のとおりです:

<Code
  lang="typescript"
  code={runningAgentsExceptionExample}
  title="ガードレールの実行エラー"
/>

上記の例を実行すると、次の出力が表示されます:

```
Guardrail execution failed: Error: Input guardrail failed to complete: Error: Something is wrong!
Math homework guardrail tripped
```

---

## 次のステップ

- [モデル](/openai-agents-js/ja/guides/models) の設定方法を学びます
- エージェントに [ツール](/openai-agents-js/ja/guides/tools) を提供します
- 本番対応のために [ガードレール](/openai-agents-js/ja/guides/guardrails) または [トレーシング](/openai-agents-js/ja/guides/tracing) を追加します
